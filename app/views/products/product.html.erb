<% content_for :product do %>

    <!--<div class="col-6 span-4">-->
    <br>
    <div class="row">
      <div class="col-8">
      <div class="alert alert-danger fade in" id = 'error' style= "visibility: hidden">

        <!--<a href="#" class="close" data-dismiss="alert">&times;</a>-->
<!---->
        <strong>Error!</strong> Please login to continue.

      </div>
        </div>
      <div class="col-4">
    <div class='row' id='featuresHeading' xmlns="http://www.w3.org/1999/html">
      <!--<div class="col-12">-->
        <!--<h2>More Products</h2>-->

        <p class="lead">
          <a href="/checkout/show" class="btn btn-danger btn-small pull-right" >Checkout</a>
        </p>
    </div><!--end col2-->
      </div>
    </div>
    <!--</div>-->
    <!--end featuresHeading-->

    <div class='row' id="features" >

      <%@products.each do |product|%>

        <div class="col-sm-3 feature">
          <form class= "form-inline" id="<%= product.id%>">
          <div class="panel">
            <div class="panel-heading">
              <h3 class="panel-title"><%= product.name%></h3>
            </div><!--end-panel-heading-->
            <img src="<%= product.image_url  %>" alt="<%= product.name %>" class="img-circle"
                 width="100" height="100">
            <hr>
            <%if product.product_stocks.count > 0 %>
            <select id="<%= product.id%>_qty" class="form-control">
              <option value="random" disabled = "true">Select Quantity</option>
              <%product.product_stocks.each do |product_stock|%>
                  <% if @prod_detail[product.id]%>
                      <% if @prod_detail[product.id][0].to_s == product_stock.id.to_s%>
                          <option value="<%= product_stock.id%>" selected = "true">
                      <%else%>
                        <option value="<%= product_stock.id%>" disabled = "true">
                      <%end%>
                        <%= product_stock.available_stock_in_grams%>
                      </option>
                  <%else%>
                  <option value="<%= product_stock.id%>">
                    <%= product_stock.available_stock_in_grams%>
                  </option>
                  <%end %>
              <%end%>
            </select>
            <%end%>
            <hr>
            <a class ="btn btn-default btn-lg" href="javascript:DoPost(<%= product.id.to_s%>)">Add To Cart</a>
            <a class ="btn btn-success btn-xs glyphicon-plus" href="javascript:DoPost(<%= product.id.to_s%>)"></a>
            <label class="alert-info " id = "<%= product.id%>_label"><%= @prod_detail[product.id].present? ? @prod_detail[product.id][1] : 0%></label>
            <a class ="btn btn-danger btn-xs glyphicon-minus" href="javascript:DoPost(<%= product.id.to_s%>, true)"></a>

            <!--<input type="submit" value="Add To cart" id="<%= product.id%>" />-->

            <!--<button id = 'create_btn' value="submit"-->
                    <!--onclick="addToCart(<%= product.id%>)" class="btn btn-warning btn-block">Add To Cart</button>-->

          </div>
          </form>

        </div> <!--end-feature-->


      <%end%>
    </div>
      <!--<div id="button-more" onclick=load_page();>-->
        <!--Load more items-->
      <!--</div>-->
      <!--<div id="loading-div">-->
        <!--loading more items-->
      <!--</div>-->
    <!--</div>-->
    <div class="row">


    <div class='col-8 pagination' id='pagination'>
    <ul class="pagination" id="page1">
      <%@product_pages = @all_product_count/12 %>
      <% @product_pages.times do |number|%>
          <li><a href="/product/fruits?page_number=<%= number%>"><%= number+1%></a></li>
      <% end%>
      <%unless @all_product_count - @product_pages == 0 %>
          <li><a href="/product/fruits?page_number=<%= @product_pages%>"><%= @product_pages+1%></a></li>
      <% end%>
    </ul>
    </div>
    <div class="col-4">
      <div class='row' id='featuresHeading' xmlns="http://www.w3.org/1999/html">
        <!--<div class="col-12">-->
        <!--<h2>More Products</h2>-->

        <p class="lead">
          <a href="/checkout/show" class="btn btn-danger btn-small pull-right" >Checkout</a>
        </p>
      </div><!--end col2-->
    </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>

    <script>
        function DoPost(product_id, is_decrement){
            var options = document.getElementById(product_id+"_qty").getElementsByTagName("option");
            var e = document.getElementById(product_id+"_qty");
            var strUser = e.options[e.selectedIndex].value;
//            var is_decrement =  typeof is_decrement !== 'undefined' ? is_decrement : false;
            $.ajax({
                url: "/products/add_product",
                beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
                dataType: "json",
                type: "POST",
                data: { product_id: product_id, stock_id: strUser, is_decrement: is_decrement },
                success: function (data) {
                 if (data !== 0)
                 {var options = document.getElementById(product_id+"_qty").getElementsByTagName("option");
                    for (var i = 0; i < options.length; i++) {
                        // lowercase comparison for case-insensitivity
                        (options[i].value.toLowerCase() == strUser)
                                ? options[i].disabled = false
                                : options[i].disabled = true ;
                    };
                 }
                    else{
                     alert('No quantity selected');
                     var options = document.getElementById(product_id+"_qty").getElementsByTagName("option");
                    for (var i = 1; i < options.length; i++) {
                        options[i].disabled = false
                    };
                 }
                    $("#"+product_id+"_label").text(data);
                },
                error:  function (xhr, ajaxOptions, thrownError) {
                    if(xhr.status == 404)
                    {
//                        alert(thrownError);
//                        ?$("#error").style.visibility ="show";
                        $("#error").attr('style','visibility: visible');
                    }
                    else{
                        alert(thrownError);
                        $("#error").attr('style','visibility: visible');
                    }
                }
            });
//            $.post("/products/add_product", { product_id: product_id, stock_id: strUser } );  //Your values here..

        }
//        $(document).ready(function(){
//            $("form").submit(function(event){
//                        alert($(this).attr("id"));
//                        var select_id = $(this).attr("id") + "_qty";
//                        var quantity = $("#"+select_id +" option:selected").text();
//                        alert(quantity);
//                var formData = {
//                    'product_id'              : $(this).attr("id"),
//                    'quantity'             : quantity
//                };
//
//                // process the form
//                $.ajax({
//                    type        : 'POST', // define the type of HTTP verb we want to use (POST for our form)
//                    url         : '/add_product', // the url where we want to POST
//                    data        : formData, // our data object
//                    dataType    : 'json', // what type of data do we expect back from the server
//                    encode          : true
//                })
//                    // using the done promise callback
//                        .done(function(data) {
//
//                            // log data to the console so we can see
//                            console.log(data);
//
//                            // here we will handle errors and validation messages
//                        });
//
//                // stop the form from submitting the normal way and refreshing the page
//                event.preventDefault();
//
//
//
//
//                    });
//
//        });
    </script>
<% end %>
